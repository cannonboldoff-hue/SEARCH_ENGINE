databases:
  - name: search-engine-db
    plan: free

services:
  - type: web
    name: search-engine-api
    runtime: docker
    plan: free
    dockerfilePath: ./apps/api/Dockerfile
    dockerContext: ./apps/api
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: search-engine-db
          property: connectionString
      - key: JWT_SECRET
        generateValue: true
      - key: CHAT_API_BASE_URL
        value: "https://api.groq.com/openai/v1"
      - key: CHAT_API_KEY
        sync: false
      - key: CHAT_MODEL
        value: "openai/gpt-oss-120b"
      - key: EMBED_API_BASE_URL
        value: "https://api.opentextembeddings.com/v1"
      - key: EMBED_API_KEY
        value: ""
      - key: EMBED_MODEL
        value: "bge-base-en"
    healthCheckPath: /health

  - type: web
    name: search-engine-web
    runtime: docker
    plan: free
    dockerfilePath: ./apps/web/Dockerfile
    dockerContext: .
    envVars:
      - key: NEXT_PUBLIC_API_BASE_URL
        fromService:
          type: web
          name: search-engine-api
          envVarKey: RENDER_EXTERNAL_URL
